# Next.js動的ルーティング - 理解度テスト回答

## 問題と解答

### 問題1: Next.jsのApp Routerで動的ルーティングを実装するためには、どのようなファイル・フォルダ構造を作成する必要がありますか？

**解答:**
角括弧 `[ ]` で囲まれたフォルダ名を作成します。例えば、`/src/app/blog/[id]/page.tsx` という構造なら、`/blog/1`, `/blog/2` などのURLでアクセスできる動的ルーティングが実装できます。

**解説:**
Next.jsのApp Routerでは、フォルダ名を角括弧で囲むことで「動的セグメント」を作成します。この命名規則によって、Next.jsはそのパスがURLの中で変動する部分であることを認識します。例えば `[id]` という名前のフォルダは、そのパスに任意の値を受け入れることができます。

### 問題2: 次のファイルパス `/src/app/users/[id]/settings/page.tsx` で作成されたページコンポーネントでは、URLパラメータをどのように取得できますか？コード例を示してください。

**解答:**
```jsx
export default function UserSettings({ params }: { params: { id: string } }) {
  return (
    <div>
      <h1>ユーザー {params.id} の設定</h1>
      {/* 設定画面の内容 */}
    </div>
  );
}
```

**解説:**
App Routerでは、ページコンポーネントは自動的に `params` プロパティを受け取ります。この `params` オブジェクトには、URLから抽出されたすべての動的セグメントの値が含まれています。`[id]` という動的セグメントの値は `params.id` でアクセスできます。TypeScriptを使う場合は、`{ params: { id: string } }` のように型を指定するとコード補完や型チェックの恩恵を受けられます。

### 問題3: Next.jsのApp Routerで「キャッチオール」ルートを実装するための正しいフォルダ名の書き方はどれですか？
   a) `(slug)`
   b) `[...slug]`
   c) `[slug*]`
   d) `{slug}`

**解答:**
b) `[...slug]`

**解説:**
三点リーダー `...` を角括弧内に追加することで、「キャッチオール」ルートを作成できます。これによって、そのパス以降のすべてのセグメントを捕捉できます。例えば、`/src/app/posts/[...slug]/page.tsx` というファイル構造なら、`/posts/2020/01/hello-world` のようなURLでアクセスでき、`params.slug` には `['2020', '01', 'hello-world']` という配列が格納されます。

### 問題4: 動的ルーティングのURLパラメータを検証（バリデーション）する方法として正しいのはどれですか？（複数選択可）
   a) generateStaticParamsでパラメータを生成する
   b) コンポーネント内でパラメータの形式を確認する
   c) middleware.tsでリクエストをフィルタリングする
   d) pages/api/validateRoute.tsでAPIエンドポイントを作成する

**解答:**
b) コンポーネント内でパラメータの形式を確認する
c) middleware.tsでリクエストをフィルタリングする

**解説:**
URLパラメータのバリデーションには主に2つの方法があります：

1. ページコンポーネント内でパラメータの形式を確認する方法：
```jsx
if (!/^\d+$/.test(params.id)) {
  return <div>無効なIDです</div>;
}
```

2. middleware.tsでリクエストをフィルタリングする方法：
```jsx
// middleware.ts
export function middleware(request: NextRequest) {
  const { pathname } = request.nextUrl;
  if (pathname.startsWith('/blog/') && !/^\/blog\/\d+$/.test(pathname)) {
    return NextResponse.redirect(new URL('/blog', request.url));
  }
}
```

generateStaticParamsはバリデーションではなく、静的生成するパラメータの指定に使用します。また、「pages/api/validateRoute.ts」というファイルはNext.jsの標準的な構成には存在しません。

### 問題5: 以下のコードの説明として正しいものはどれですか？
```jsx
export function generateStaticParams() {
  return [
    { id: '1' },
    { id: '2' },
    { id: '3' },
  ];
}
```

a) ビルド時に静的に生成されるページのパラメータを指定している
b) 動的ルーティングで受け付けるパラメータを制限している
c) サーバーサイドレンダリングで使用するパラメータを定義している
d) クライアントサイドでのルーティングパラメータを設定している

**解答:**
a) ビルド時に静的に生成されるページのパラメータを指定している

**解説:**
`generateStaticParams` 関数は、ビルド時に静的に生成されるページのパラメータを指定するために使用されます。この例では、`/blog/1`、`/blog/2`、`/blog/3` に対応するページがビルド時に静的に生成されます。これにより、これらのページへのアクセスが高速になり、サーバーの負荷も軽減されます。しかし、この関数はパラメータを制限するものではなく、指定されていないパラメータでもページはオンデマンドでレンダリングされます（SSRまたはISRとして）。 