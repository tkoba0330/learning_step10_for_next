# Next.jsの動的ルーティング講座

## 学習目標
Next.jsの「動的ルーティング」について学び、URLパラメータによって内容が変わるページを作れるようになること。特にブログ記事ページや商品詳細ページなど実践的な例を通じて理解を深める。

## 動的ルーティングの基本

### 1. 動的ルーティングのフォルダ構造

```
/src/app/blog/[id]/page.tsx
```

このファイル構造のポイント：
- `blog` - 通常のフォルダで、`/blog` というURLパスになる
- `[id]` - 角括弧（`[]`）で囲まれたフォルダは「動的セグメント」と呼ばれ、URLの中で変動する部分になる

例えば以下のURLはすべて同じページコンポーネントでレンダリングされる：
- `/blog/1` 
- `/blog/2`
- `/blog/hello-world`

### 2. 動的パラメータの取得方法

```jsx
export default function BlogPost({ params }: { params: { id: string } }) {
  return (
    <div className="p-8">
      <h1 className="text-3xl font-bold mb-4">ブログ記事 {params.id}</h1>
      <p className="mb-4">これは動的ルーティングで生成されたブログ記事ページです！</p>
      <p className="mb-4">URLのパラメータ: <span className="font-bold">{params.id}</span></p>
    </div>
  );
}
```

重要ポイント：
1. `params` プロパティをコンポーネントが受け取る
2. `params.id` で URL から取得したパラメータにアクセスできる
3. TypeScriptの型定義 `{ params: { id: string } }` で明示的に型を指定する

### 3. ブログ一覧ページとリンク

ブログ一覧ページ (`/src/app/blog/page.tsx`)：

```jsx
import Link from 'next/link';

export default function BlogList() {
  // サンプルのブログ記事リスト
  const blogPosts = [
    { id: '1', title: '初めてのNext.js' },
    { id: '2', title: '動的ルーティングについて' },
    { id: '3', title: 'Reactの基本' },
    { id: '4', title: 'TailwindCSSの使い方' },
    { id: '5', title: 'TypeScriptとは' },
  ];

  return (
    <div className="p-8">
      <h1 className="text-3xl font-bold mb-6">ブログ記事一覧</h1>
      <ul className="space-y-4">
        {blogPosts.map((post) => (
          <li key={post.id} className="border p-4 rounded-lg hover:bg-gray-50">
            <Link href={`/blog/${post.id}`} className="text-blue-500 hover:underline">
              {post.title}
            </Link>
          </li>
        ))}
      </ul>
    </div>
  );
}
```

重要ポイント：
1. `Link` コンポーネントを使ってページ間のナビゲーションを行う
2. `href={`/blog/${post.id}`}` で動的なURLを生成する
3. 実際のアプリではデータはAPIやデータベースから取得する

## 動的ルーティングとデータフェッチングの組み合わせ

### データフェッチング関数の実装

```jsx
// データフェッチング関数
async function getPostData(id: string) {
  // 実際のアプリではここでAPIを呼び出す
  // 今回はモックデータを返す
  const posts = {
    '1': {
      title: '初めてのNext.js',
      content: 'Next.jsは素晴らしいReactフレームワークです。Reactの基本を知っていれば、すぐに始められます。',
      author: 'ゆうき',
      date: '2023-10-15'
    },
    // 他の記事データ...
  };
  
  // 指定されたIDの投稿があるか確認
  const post = posts[id as keyof typeof posts];
  
  if (!post) {
    // 投稿が見つからない場合はnullを返す
    return null;
  }
  
  return post;
}

// ブログ記事コンポーネント
export default async function BlogPost({ params }: { params: { id: string } }) {
  // パラメータからデータを取得
  const post = await getPostData(params.id);
  
  return (
    <div className="p-8 max-w-4xl mx-auto">
      <h1 className="text-3xl font-bold mb-4">{post.title}</h1>
      
      <div className="text-gray-500 mb-6">
        <p>投稿者: {post.author} | 投稿日: {post.date}</p>
      </div>
      
      <div className="prose lg:prose-xl">
        <p>{post.content}</p>
      </div>
    </div>
  );
}
```

## URLパラメータの検証（Validation）

```jsx
// ブログ記事コンポーネント
export default async function BlogPost({ params }: { params: { id: string } }) {
  // URLパラメータを検証（数字のみ許可）
  if (!/^\d+$/.test(params.id)) {
    return (
      <div className="p-8 max-w-4xl mx-auto">
        <div className="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded" role="alert">
          <h1 className="font-bold text-xl mb-2">無効なブログIDです</h1>
          <p>ブログIDは数字である必要があります。</p>
        </div>
      </div>
    );
  }
  
  // パラメータからデータを取得...
}
```

## 静的生成のためのパラメータ指定

```jsx
// 有効なIDのリストを生成する関数
export function generateStaticParams() {
  return [
    { id: '1' },
    { id: '2' },
    { id: '3' },
    { id: '4' },
    { id: '5' },
  ];
}
```

この関数はビルド時に指定されたパラメータのページを静的に生成するために使用されます。

## 動的ルーティングとナビゲーション

ナビゲーションコンポーネント (`/src/app/components/PostNavigation.tsx`)：

```jsx
import Link from 'next/link';

interface PostNavigationProps {
  currentId: string;
  maxId: number;
}

export default function PostNavigation({ currentId, maxId }: PostNavigationProps) {
  const id = parseInt(currentId);
  const hasPrevious = id > 1;
  const hasNext = id < maxId;
  
  return (
    <div className="flex justify-between mt-10 pt-6 border-t border-gray-200">
      {hasPrevious ? (
        <Link href={`/blog/${id - 1}`} className="px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200">
          ← 前の記事
        </Link>
      ) : (
        <div></div>
      )}
      
      <Link href="/blog" className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
        一覧に戻る
      </Link>
      
      {hasNext ? (
        <Link href={`/blog/${id + 1}`} className="px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200">
          次の記事 →
        </Link>
      ) : (
        <div></div>
      )}
    </div>
  );
}
```

## 動的ルーティングの特徴と応用

### 1. 複数のパラメータを使う方法

```
/src/app/blog/[category]/[id]/page.tsx
```

コンポーネントでの取得方法：
```jsx
export default function BlogPost({ params }: { params: { category: string, id: string } }) {
  return (
    <div>
      <h1>カテゴリ: {params.category}</h1>
      <h2>記事ID: {params.id}</h2>
    </div>
  );
}
```

### 2. キャッチオールルート

```
/src/app/posts/[...slug]/page.tsx
```

コンポーネントでの取得方法：
```jsx
export default function Post({ params }: { params: { slug: string[] } }) {
  // slugは配列になる
  // /posts/2020/01/01/hello-world なら ['2020', '01', '01', 'hello-world']
  return (
    <div>
      <h1>スラグ: {params.slug.join('/')}</h1>
    </div>
  );
}
```

### 3. オプショナルキャッチオールルート

```
/src/app/docs/[[...slug]]/page.tsx
```

これは `/docs`, `/docs/getting-started`, `/docs/getting-started/installation` など全てのパターンに対応できます。

## まとめ

Next.jsの動的ルーティングを使うと：

1. URLパラメータを使った柔軟なページが作れる
2. 同じページコンポーネントで異なるデータを表示できる
3. きれいなURL構造が簡単に作れる
4. 複雑なアプリでも管理しやすいファイル構造が作れる

